<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>자율주행 순찰 로봇 관제 대시보드</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <link rel="stylesheet" href="/static/main.css">

</head>
<body class="min-h-screen p-4 md:p-8">

  <div class="max-w-8xl mx-auto">
    <header class="flex justify-between items-center mb-8 pb-4 border-b-2 border-blue-200">
      <h1 class="text-4xl font-extrabold text-gray-800 flex items-center">
        <i class="fas fa-robot text-blue-500 mr-3"></i> 순찰 로봇 관제 대시보드
      </h1>
      <div class="flex items-center space-x-4">
        <div id="ros-status" class="flex items-center space-x-2 text-lg font-semibold">
          <span id="status-indicator" class="w-4 h-4 rounded-full bg-red-500"></span>
          <span id="status-text" class="text-red-700">ROS 연결 중...</span>
        </div>
        <a href="/logout" class="bg-red-500 hover:bg-red-600 text-white font-semibold py-2 px-4 rounded-lg transition duration-150">
          로그아웃 <i class="fas fa-sign-out-alt ml-1"></i>
        </a>
      </div>
    </header>

    <div class="grid grid-cols-12 gap-8 relative">
      <!-- 메인 영역 -->
      <div id="main-content-area" class="col-span-12 xl:col-span-8 space-y-4">
        <div class="main-view-container relative">
          <!-- 지도 메인 -->
          <div id="map-main" class="main-view dashboard-card p-4 aspect-video relative">
            <h2 class="text-2xl font-semibold text-gray-700 mb-4 flex items-center">
                <i class="fas fa-map-marked-alt text-blue-500 mr-2"></i> SLAM 순찰 지도 및 실시간 위치
            </h2>

            <!-- ✅ 리셋 버튼 추가 -->
            <button id="reset-view-btn" 
                    class="absolute top-5 right-5 bg-blue-500 hover:bg-blue-700 text-white text-sm font-semibold py-2 px-3 rounded-lg shadow">
                <i class="fas fa-sync-alt mr-1"></i> 뷰 리셋
            </button>

            <div class="w-full h-full bg-gray-100 flex items-center justify-center rounded-lg overflow-hidden relative">
                <canvas id="map-canvas" class="w-full h-full object-cover rounded-lg bg-white"></canvas>
                <p id="map-placeholder" class="absolute text-gray-500 text-center p-8">
                </p>
            </div>
            </div>

          <!-- 비디오 메인 -->
          <div id="video-main" class="main-view dashboard-card p-4 aspect-video absolute inset-0 hidden">
            <h2 class="text-2xl font-semibold text-gray-700 mb-4 flex items-center">
              <i class="fas fa-video text-green-500 mr-2"></i> 실시간 상황 보기 (웹캠)
            </h2>
            <div class="w-full h-full bg-gray-800 flex items-center justify-center rounded-lg relative">
              <img id="webcam-feed" alt="실시간 웹캠 피드" class="w-full h-full object-contain rounded-lg">
              <p id="video-placeholder" class="text-white text-lg absolute">웹캠 스트리밍 시작 대기 중...</p>
            </div>
          </div>

          <!-- 축소 보기 -->
          <div id="map-small" class="small-view bg-white hidden" onclick="toggleMainView('map')">
            <canvas id="map-small-canvas" class="w-full h-full object-cover rounded-md bg-gray-100"></canvas>
            <span class="absolute top-0 left-0 p-1 text-xs font-bold text-gray-700 bg-white bg-opacity-70 rounded-br-lg">🗺️ 지도</span>
          </div>
          <div id="video-small" class="small-view bg-white" onclick="toggleMainView('video')">
            <img id="webcam-small-feed" alt="작은 웹캠 피드" class="w-full h-full object-contain rounded-md bg-gray-800">
            <span class="absolute top-0 left-0 p-1 text-xs font-bold text-gray-700 bg-white bg-opacity-70 rounded-br-lg">📹 웹캠</span>
          </div>
        </div>

        <!-- 지도 하단 제어 / 위치 -->
        <div id="patrol-control-map" class="dashboard-card p-4 hidden">
          <h2 class="text-xl font-semibold text-gray-700 mb-4 flex items-center">
            <i class="fas fa-play-circle text-blue-500 mr-2"></i> 순찰 명령
          </h2>
          <div class="grid grid-cols-4 gap-4">
            <button onclick="publishMission('repeat')" class="btn-action bg-yellow-500 hover:bg-yellow-600 text-white col-span-1">
              <i class="fas fa-redo-alt mr-1"></i> 반복순찰
            </button>
            <button onclick="publishMission('single')" class="btn-action bg-green-600 hover:bg-green-700 text-white col-span-1">
              <i class="fas fa-location-arrow mr-1"></i> 1회 순찰
            </button>
            <button onclick="publishMission('return')" class="btn-action bg-indigo-600 hover:bg-indigo-700 text-white col-span-1">
              <i class="fas fa-home mr-1"></i> 복귀
            </button>
            <button onclick="publishCommand('stop')" class="btn-action bg-red-600 hover:bg-red-700 text-white col-span-1">
              <i class="fas fa-stop mr-1"></i> 정지
            </button>
          </div>
        </div>

        <div id="robot-location-card" class="dashboard-card p-4 hidden">
          <h2 class="text-xl font-semibold text-gray-700 mb-2 flex items-center">
            <i class="fas fa-crosshairs text-blue-500 mr-2"></i> 현재 로봇 좌표
          </h2>
          <div id="robot-location" class="text-gray-600 font-bold text-lg">N/A</div>
        </div>
      </div>

      <!-- 사이드패널 -->
      <div class="col-span-12 xl:col-span-4 space-y-6">
        <div class="dashboard-card p-6 text-center">
          <h2 class="text-2xl font-semibold text-gray-700 mb-4 flex items-center justify-center">
            <i class="fas fa-info-circle text-blue-500 mr-2"></i> 로봇 현재 상태
          </h2>
          <span id="metric-status" class="status-badge bg-gray-200 text-gray-800">
            <i class="fas fa-spinner fa-spin mr-3"></i> 연결 대기 중
          </span>
        </div>

        <div id="manual-control" class="dashboard-card p-6 hidden">
          <h2 class="text-2xl font-semibold text-gray-700 mb-4 flex items-center">
            <i class="fas fa-gamepad text-orange-500 mr-2"></i> 수동 제어
          </h2>
          <div class="grid grid-cols-3 gap-3">
            <div class="col-span-3 text-center">
              <button onclick="publishCommand('forward')" class="btn-action bg-blue-600 hover:bg-blue-700 text-white w-full"><i class="fas fa-arrow-up"></i> 전진</button>
            </div>
            <button onclick="publishCommand('left')" class="btn-action bg-blue-500 hover:bg-blue-600 text-white"><i class="fas fa-arrow-left"></i> 좌회전</button>
            <button onclick="publishCommand('stop')" class="btn-action bg-red-600 hover:bg-red-700 text-white">정지</button>
            <button onclick="publishCommand('right')" class="btn-action bg-blue-500 hover:bg-blue-600 text-white"><i class="fas fa-arrow-right"></i> 우회전</button>
            <div class="col-span-3 text-center">
              <button onclick="publishCommand('backward')" class="btn-action bg-blue-600 hover:bg-blue-700 text-white w-full"><i class="fas fa-arrow-down"></i> 후진</button>
            </div>
          </div>
        </div>

        <div class="dashboard-card p-6">
          <h2 class="text-2xl font-semibold text-gray-700 mb-4 flex items-center">
            <i class="fas fa-camera text-blue-600 mr-2"></i> 웹캠 제어
          </h2>
          <button onclick="toggleVideoFeed()" class="btn-action bg-blue-500 hover:bg-blue-600 text-white w-full">
            <i class="fas fa-camera mr-2"></i> 웹캠 스트리밍 토글
          </button>
        </div>

        <div class="dashboard-card p-6">
          <h2 class="text-2xl font-semibold text-gray-700 mb-6 flex items-center">
            <i class="fas fa-tachometer-alt text-teal-500 mr-2"></i> 로봇 실시간 메트릭
          </h2>
          <div class="grid grid-cols-2 gap-4">
            <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
              <p class="text-sm text-blue-600 font-medium"><i class="fas fa-battery-full mr-1"></i> 배터리 잔량</p>
              <span id="metric-battery" class="metric-value text-blue-900">--%</span>
            </div>
            <div class="bg-indigo-50 p-4 rounded-lg border border-indigo-200">
              <p class="text-sm text-indigo-600 font-medium"><i class="fas fa-route mr-1"></i> 순찰 거리</p>
              <span id="metric-distance" class="metric-value text-indigo-900">-- m</span>
            </div>
            <div class="bg-purple-50 p-4 rounded-lg border border-purple-200 col-span-2">
              <p class="text-sm text-purple-600 font-medium"><i class="fas fa-clock mr-1"></i> 순찰 시간</p>
              <span id="metric-time" class="metric-value text-purple-900">-- min</span>
            </div>
          </div>
        </div>

        <div class="dashboard-card p-6">
          <h2 class="text-2xl font-semibold text-gray-700 mb-6 flex items-center">
            <i class="fas fa-thermometer-half text-orange-500 mr-2"></i> 환경 센서 값
          </h2>
          <div class="grid grid-cols-3 gap-4">
            <div class="bg-red-50 p-4 rounded-lg border border-red-200">
              <p class="text-sm text-red-600 font-medium">온도</p>
              <span id="metric-temp" class="text-xl font-extrabold text-red-900">-- °C</span>
            </div>
            <div class="bg-yellow-50 p-4 rounded-lg border border-yellow-200">
              <p class="text-sm text-yellow-600 font-medium">가스/연기</p>
              <span id="metric-gas" class="text-xl font-extrabold text-yellow-900">-- ppm</span>
            </div>
            <div class="bg-green-50 p-4 rounded-lg border border-green-200">
              <p class="text-sm text-green-600 font-medium">TVOC</p>
              <span id="metric-tvoc" class="text-xl font-extrabold text-green-900">-- ppb</span>
            </div>
          </div>
        </div>
      </div>
    </div> <!-- grid -->
  </div> <!-- container -->

  <script src="/static/main.js"></script>
</body>
</html>
